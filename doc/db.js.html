<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: db.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: db.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//TODO Potentially implement https://www.npmjs.com/package/github-db instead of file based db.
const DB = require('flat-db');
const path = require('path');
const dbPath = path.join(process.cwd(),'db');
App.Utils.Log.msg(['Current DB Path is:', dbPath])

//Set database path to be directory where this utility was executed.
DB.configure({
    dir: dbPath
})

/**
 * Filter all upstreamOutdated == 'outdated' items within App.Pantheon.sites.all[]
 * @param site
 * @returns {Object} Items that are upstreamOutdated == 'outdated'
 */
function filterUpstreams(site){
    return site.upstreamOutdated == 'outdated';
}

/**
 * Private function to write site JSON Object to File Db Storage
 * @param details
 * @returns {String} Returns key created for object written to File Db Storage
 */
function site(details){
    let Site = new DB.Collection('sites');
    let key = Site.add(details);
    return key;
}
Db = {
    Collection:{
        sites: new DB.Collection('sites')
    },
    get: {
        /**
         *
         * @returns {*|{src}|Promise.&lt;*>}
         */
        sites: function(){
            let Site = new DB.Collection('sites');
            let all = Site.all();
            if (all.length > 0){
                // We have sites to process..otherwise, simply do nothing.
                let outdatedUpstreams = App.Pantheon.sites.all.filter(filterUpstreams)
            }
            App.Utils.Log.msg(['Loaded',all.length,'sites from CWB/DB/ File Database']);
            return all;
        }
    },
    add: {
        /**
         * Add site JSON to File Db Storage @ dbPath
         * @param details
         * @returns {Object} JSON Site Object
         */
        site: function (details){
             let key = site(details);
             return key;
        }
    }
}

module.exports = Db;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkUpstream">checkUpstream</a></li><li><a href="global.html#createMultidev">createMultidev</a></li><li><a href="global.html#createMultidevs">createMultidevs</a></li><li><a href="global.html#ensureSetup">ensureSetup</a></li><li><a href="global.html#fillSites">fillSites</a></li><li><a href="global.html#fillUpstreamUpdates">fillUpstreamUpdates</a></li><li><a href="global.html#filterUpstreams">filterUpstreams</a></li><li><a href="global.html#multidevExists">multidevExists</a></li><li><a href="global.html#newFillSite">newFillSite</a></li><li><a href="global.html#Pantheon">Pantheon</a></li><li><a href="global.html#scanForPatches">scanForPatches</a></li><li><a href="global.html#site">site</a></li><li><a href="global.html#writeSiteToDb">writeSiteToDb</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon Oct 02 2017 14:54:03 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
